
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>&lt;no title&gt; &#8212; CaImAn 1.4 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">CaImAn 1.4 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>CaImAn is designed to perform analysis on datasets saved over a single
or multiple files. However maximum efficiency is achieved when each
dataset is saved as a sequence of files of medium size (1-2GBs). Please
note the following:</p>
<ul class="simple">
<li>If you’re using TIFF files make sure that the files are saved in
multipage format. This is particularly important as multipage TIFF
files can be indexed and individual frames can be read without
loading the entire file in memory. On the contrary single page TIFFs
would load the entire file before reading an individual frame. This
can cause significant problems in CaImAn in terms of speed and memory
consumption, as a lot of the parallelization (e.g.&nbsp;during motion
correction) happens by passing the path to a file to multiple
processes each of which will only read and process a small part of
it. <strong>Bear in mind that TIFF files of size 4GB or larger saved
through ImageJ/FIJI are automatically save in single page format and
should be avoided</strong>. If you have such a file you can split into
multiple shorter files through ImageJ/FIJI or through CaImAn using
the following script</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">caiman</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># path to file</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>  <span class="c1"># load the file</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># total number of frames for the file</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># length of each individual file</span>
<span class="n">fileparts</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">L</span><span class="p">):</span>
   <span class="n">m</span><span class="p">[</span><span class="n">t</span><span class="p">:</span><span class="n">t</span><span class="o">+</span><span class="n">L</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">((</span><span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fileparts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="o">//</span><span class="n">L</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">fileparts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<p>HDF5/H5 files in general do not suffer from this problem.</p>
<ul class="simple">
<li>Single frame files should be avoided. The reason is that several
functions, e.g.&nbsp;motion correction, memory mapping, are designed to
work on small sets of frames and in general assume that each file has
more than 1 frames. If your data is saved as a series of single frame
files, you should convert them in a single (or multiple) files. You
can do this by using the following script:</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">caiman</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="n">fld</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># path to folder where the data is located</span>
<span class="n">fls</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span><span class="s1">&#39;*.tif&#39;</span><span class="p">))</span>  <span class="c1">#  change tif to the extension you need</span>
<span class="n">fls</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>  <span class="c1"># make sure your files are sorted alphanumerically</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">load_movie_chain</span><span class="p">(</span><span class="n">fls</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fld</span><span class="p">,</span><span class="s1">&#39;data.tif&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>If the number of frames is too big, you can split into multiple files as
explained above. Make sure that your files are sorted alphanumerically
before combining them. This can be tricky if your files are initially
saved as ’file1.tif, file2.tif, …, file10.tif`. In this case you can
consult this <a class="reference external" href="https://wiki.python.org/moin/HowTo/Sorting">page</a>.</p>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/On-file-types-and-sizes.md.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">CaImAn 1.4 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Flatiron Institute, Simons Foundation, New York, NY.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>